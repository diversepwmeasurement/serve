jobs:
  kubernetes-tests:
    runs-on: self-hosted
    steps:
    - continue-on-error: true
      name: Clean up previous run
      run: 'echo "Cleaning up previous run"

        ls -la ./

        sudo rm -rf ./* || true

        sudo rm -rf ./.??* || true

        ls -la ./

        '
    - continue-on-error: true
      name: Install minikube and kubectl
      run: 'curl -LO https://storage.googleapis.com/minikube/releases/latest/minikube-linux-amd64

        sudo install minikube-linux-amd64 /usr/local/bin/minikube

        curl -LO "https://dl.k8s.io/release/$(curl -L -s https://dl.k8s.io/release/stable.txt)/bin/linux/amd64/kubectl"

        sudo install -o root -g root -m 0755 kubectl /usr/local/bin/kubectl

        echo "/usr/local/bin" >> $GITHUB_PATH

        '
    - continue-on-error: true
      name: Setup Python 3.9
      uses: actions/setup-python@v5
      with:
        architecture: x64
        python-version: 3.9
    - continue-on-error: true
      name: Checkout TorchServe
      uses: actions/checkout@v3
    - continue-on-error: true
      name: Validate TorchServe
      run: ./kubernetes/tests/scripts/test_mnist.sh
name: Kubernetes Nightly Tests
on:
  repository_dispatch:
    types: trigger-ga___kubernetes_tests.yml
